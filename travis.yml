language: c

matrix:
    os: linux
      env:
        - TEST="CppCheck"
        - TARGET_CPU=amd64 BUILD_CONFIGURATION=Debug
        - TARGET_CPU=amd64 BUILD_CONFIGURATION=Release
        - TARGET_CPU=x86 BUILD_CONFIGURATION=Debug
        - TARGET_CPU=x86 BUILD_CONFIGURATION=Release
      dist: trusty
      sudo: true
      compiler:
        - gcc
        - clang
      addons:
       apt:
         sources:
           - ubuntu-toolchain-r-test
         packages:
           - gcc-4.8
           - g++-4.8
           - clang-3.7
           - valgrind
           - cppcheck
        script:
             - cmake -DENABLE_CPPCHECK=ON -DCMAKE_CXX_COMPILER="g++-6" ..
             - make
             - make check

before install:
  - sudo apt update
  - sudo apt install valgrind
  - sudo apt install cmake
install:
    - if [ "$CXX" = "clang++" ] && [ "$TRAVIS_OS_NAME" = "linux" ]; then export CXX="clang++-3.7" CC="clang-3.7"; fi
    - echo ${PATH}
    - echo ${CXX}
    - ${CXX} --version
    - ${CXX} -v

      #
      # Update / Install CMake
      #
    - |
        if [[ "${TRAVIS_OS_NAME}" == "linux" ]]; then
          mkdir -p external/cmake
          pushd external/cmake
          wget https://cmake.org/files/v3.8/cmake-3.8.0-Linux-x86_64.sh
          chmod +x cmake-*-Linux-x86_64.sh
          ./cmake-*-Linux-x86_64.sh --exclude-subdir --skip-license
          export PATH="${PWD}/bin:$PATH"
          popd
        else
          if ! brew ls --version cmake &>/dev/null; then brew update; brew install cmake; fi
        fi

script:
    ############################################################################
    # Build main and tests
    ############################################################################
     - cmake
     - make
